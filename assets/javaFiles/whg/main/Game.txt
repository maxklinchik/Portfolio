//Max
//Program Description:
//May 8, 2025
//
package main;

import java.awt.Color;
import java.awt.Font;
import java.awt.Graphics;

import gamestates.Gamestate;
import gamestates.LevelManager;

public class Game implements Runnable {
   private LevelManager levelManager;

   private Thread gameThread;
   private Window window;
   private Panel panel;
   private final int FPS_SET = 120;
   private final int UPS_SET = 200;
   public static final int PANEL_WIDTH = 1200;
   public static final int PANEL_HEIGHT = 700;
   public static int deaths;
   
   public Game() {
      levelManager = new LevelManager();
      panel = new Panel(this);
      window = new Window(panel);
      
      startGameLoop();
   }
   
   private void startGameLoop() {
      gameThread = new Thread(this);
      gameThread.start();
   }
   
   public void update() {
      levelManager.update();
   }
   
   public void render(Graphics g) {
      levelManager.render(g);
   }
   
   private void timerRun() {
//      System.out.println(Gamestate.gamestate);
   }
   
   public void run() {
      double timePerFrame = 1000000000.0 / FPS_SET;
      double timePerUpdate = 1000000000.0 / UPS_SET;
      
      long previousTime = System.nanoTime();
      
      int frames = 0;
      int updates = 0;
      long lastCheck =  System.currentTimeMillis();
      
      double deltaU = 0;
      double deltaF = 0;
      
      while (true) {
         long currentTime = System.nanoTime();
         
         deltaU += (currentTime - previousTime) / timePerUpdate;
         deltaF += (currentTime - previousTime) / timePerFrame;
         previousTime = currentTime;
         
         if (deltaU >= 1) {
            update();
            updates++;
            deltaU--;
         }
         
         if (deltaF >= 1) {
            panel.repaint();
            frames++;
            deltaF--;
            timerRun();
         }
         
         if (System.currentTimeMillis() - lastCheck >= 1000) {
            lastCheck = System.currentTimeMillis();
            System.out.println("FPS: " + frames + " | UPS: " + updates);
            frames = 0;
            updates = 0;
         }
         
      }
   }
   
   public LevelManager getLevelManager() {
      return levelManager;
   }
   
   public static void addToDeaths() {
      deaths++;
   }
   
   public static int getDeaths() {
      return deaths;
   }
   
   public static void drawDeaths(Graphics g) {
      g.setFont(new Font("Cooper Black", Font.BOLD, 15));
      g.setColor(Color.BLACK);
      g.drawString("Deaths: " + deaths, 1110, 680);
   }
   
}
